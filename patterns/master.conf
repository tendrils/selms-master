[global] {
  maildomain = auckland.ac.nz
  hostdomain = auckland.ac.nz
  mail_server = mailhost.auckland.ac.nz
  mail_subject = SELMS-0.9 Periodic Report
  log_dir = /logs/HOSTS
  offset = selms
  max_log_recs = 1000
  rt_socket = /var/syslog/selms-rt-fifo

    [actions] {
       Alert, warn:  email
       Alert rt:  email, acc 10 min  # send first alert and then acc 10 minutes
       warn rt:  acc 10 min, email  # accumulate for 10 minutes then send
       report : email
    }

}

include +UNIX.conf
include +dns.conf
include +itss-unix.conf
include +itss-windows.conf


[host default : email=>irt ] {
    [actions] {
       Alert: email
       Warn:  email
       Alert rt: nagios('nagios.auckland.ac.nz', '2bmshtr') 
       warn rt:  nagios('nagios.auckland.ac.nz', '2bmshtr'), acc 10 min   # accumulate for 10 minutes then send
       report : email
   }
  [realtime] {
    proc sudo	: warn      
  }
   service unix
   service cisco
}

[host default-unix : email=>itss-unix-admin] {
    [actions] {
       Alert, warn:  email# 
       Alert rt:  nagios('nagios.auckland.ac.nz', '2bmshtr') 
       warn rt:  nagios('nagios.auckland.ac.nz', '2bmshtr'),  acc 10 min
#      warn rt:  acc 10 min, email  # accumulate for 10 minutes then send
       report : email
    }
    service unix
    service sendmail
    service sshd
    service itssunixadmin
  [realtime] {
    proc sudo	: warn      
  }
}





[service aceserver : proc=>aceserver6.1 ] {
  [periodic] {
    /^\(\d\) ACESYNCHD : Primary Finished/				: drop 
    /^\(\d\) ACESYNCHD : Replica Finished Reconciliation Pass/	: drop
    /^\(\d\) AUTHENTICATION : Modifications to the token record have simultaneously occurred on separate Servers/	: drop
    /^\(\d\) AUTHENTICATION : Modifications to the Agent Host record have simultaneously occurred on separate Servers/	:drop
    /^\(\d\) AUTHENTICATION : Most recent successful authentication occurred on a Replica Server/			: drop
    /^\(\d\) AUTHENTICATION : Failed authentication attempts occurred on separate Servers/			: drop
    /^\(\d\) AUTHENTICATION : Using latest Agent Host record information generated on Remote Server./		: drop
    /sslReadServer:.+: read failure: (131) Connection reset by peer/	: drop
  }
}



$PATEKE_ADMINS = (?:s-rful011|s-bzdr001)

[host insec : /\.insec$/	; email=>irt] {
  service linux  service sshd
  service sendmail
  service redhat

}


[host pateke.itss : email=>irt] {
  service linux
  service sshd
  service sendmail
  service redhat
  service nagios
  [realtime] {
    proc syslog-ng & re /syslogd shutdown /					: alert
  }
  [periodic] {
    proc syslog-ng & re /syslogd shutdown /					: alert
    proc syslog-ng & re /Log statistics;/					: drop
    proc sendmail & re /Authentication-Warning: pateke.\S+: logowner set sender to/		: drop
    proc sudo & re /^ace_dir_env is/						: drop
    proc sudo & re /^service name is :: sudo/					: drop
    proc sshd & re /Setting tty modes failed: Invalid argument/			: drop
    proc sshd & re /session closed for user $PATEKE_ADMINS/			: drop
    proc sshd & re /Accepted keyboard-interactive for $PATEKE_ADMINS from 130.216\.(4\.(12|120|104)|191\.70|)/	: drop
    proc sshd & re /fatal: Read from socket failed:/				: drop
    proc sshd & re /session closed for user $PATEKE_ADMINS/			: drop
    proc sudo & re /^$PATEKE_ADMINS /						: drop
    proc su & re /^session closed for user logowner/				: drop
  }
}

[host kahu.insec : email=>irt] {
  service linux
  service sshd
  service nagios
}

[service exchange: file=>user \
         ( /(\d+) (\d{4} \w{3}\s+\d+ [:0-9]+ (?:\+|-)\d\d:\d\d) ([^:]+): (?:(\w+):)?\s*(.+)?/ 	)] {

  [periodic] {
    re /w3svc\[warning\] 100  The server was unable to logon the Windows NT/	: drop
    re /security\[failure\] 529 NT AUTHORITY\\SYSTEM  Logon Failure:/		: drop
    re /private\[failure\] 1023  (\w+\\\w+) was validated as/			: count  5 "%1 unable to log in", drop
  }
}

[host finxchange-backup.itss : email=>itss-windows-admin] {
  service exchange 
}

[host vxchange-backup.itss : email=>itss-windows-admin] {
  service exchange 
}



[host nevil-res.itss : re /nevil-res\d\.itss/	; email=>n.brownlee] {
  service unix 
  service linux
  service sshd
  [periodic ] {
     proc sudo & re /^jbro111/	: drop
  }
}

[host puweto.itss : email=>irt]  {
  service unix
  service aceserver
  [periodic] {
     proc sudo & re %r!^ace_dir_env is VAR_ACE=/var/ace!		:drop
     proc sudo & re %r!^service name is :: sudo!			:drop
  }
}

[host tauhou.itss : email=>irt]  {
  service unix
  service aceserver
}
