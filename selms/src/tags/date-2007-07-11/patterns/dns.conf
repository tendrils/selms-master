[global] {
  maildomain = auckland.ac.nz
  hostdomain = auckland.ac.nz
  mail_server = mailhost.auckland.ac.nz
  log_dir = /logs/HOSTS
  offset = selms

  include +UNIX.conf

}


[service solaris : file => all ( solaris ) ] {
  service unix
  service sshd
  service srs
}

[Service cisco : file => all ( cisco ) ] {
  [periodic]{
    cat LINEPROTO & level 5 & event UPDOWN	: drop
    cat LINK & level 5 & event CHANGED		: drop
    cat TAC & level 6 & event SENDTMO		: drop
    cat LINK & level 3 & event UPDOWN		: drop
    cat AT & level 6 & event NODEWRONG & /Vlan\d+: AppleTalk node /	: drop
    cat RTD & level 1 & /LINK_FLAP: (\S+)/	: count 5 "link flap for %1", drop
    cat LINK & level 4 & /ERROR: (\S+)/		: count 3 '%1 is experiencing errors', drop
    cat PIM & level 6 & /INVALID_RP_JOIN: .+ from (\S+) for invalid RP (\S+)/	: count 0 'Join from %1 for invalid RP %2', drop
    cat CDP & level 4 & /-DUPLEX_MISMATCH: duplex mismatch discovered on (\S+)/	: count 0 'Duplex mismatch on %1', drop
    cat PIM & level 1 & /INVALID_RP_REG: Received Register from (\S+) for \S+, not willing to be RP/	:count 10 "not willing to be RP for %1", drop
    cat MSDP & level 4 & /SA_LIMIT: SA from peer (\S+) .+exceeded sa-limit of (\d+)/	: \
       count 0 'exceeded sa-limit of %2 from peer %1', drop
  }
}

[service dial_in ] {
  service cisco
  [periodic] {
     level (5..6)		: drop
    cat LINEPROTO & /UPDOWN:/		: drop
    cat ISDN & level  6			: drop
    cat link & level 5 & event CHANGED	: drop
    cat LINK & level 3			: drop
  }
}

[service vpn ] { 

  service cisco
  [periodic] {
     level 5		: drop
     cat auth & level 4 & /RPT=\d+: (\S+): Authentication rejected: .+user = (\S+), /	: count 2 "Auth failed for %2 from %1 (times 3)", drop
  }
}

[service foundry ] {
  [periodic] {
    re /./	: drop
  }
}

[host default-cisco : email=> dns-network-admins ] {
    [actions] {
       Alert:  email
       Alert rt:  email, acc 5 min
    }
    service cisco
}

[host itss-p6s-253.net : email=>dns-network-admins] {
  service cisco
}

[host itss-s6s-253.net : email=>dns-network-admins] {
  service cisco
}

[host switch : re /(e|b|f)x.*\.net/	; email=>neteng-staff] { 
  service cisco
}

[host core-switch : re /(s|c)x.*\.net/	; email=>dns-network-admins ] { 
  service cisco
}

[host ap.tel :  /^ap.*\.(net|tel)/	; email=>dns-network-admins ] { 
  service cisco
}

[host prim-to-itss-sx.net : email=>dns-network-admins] {
  service cisco 
  [periodic] {
    cat SEC & level 6 & event IPACCESSLOGP & /list 122 denied/	: ignore
  }
}

[host dns: re /dns\d/	; email=>dns-apps-logs] {
  service linux
  service sshd
  service sendmail
  service bind9
}

[host dhcp : re /dhcp\d.tmk/	; email=>dns-apps-logs] {
  service linux
  service sendmail
  service sshd
  service bind9
}


[host tacas : re /tacacs\d.itss/	; email=>dns-apps-logs]  {
  service linux
  service sendmail
  service sshd
  [periodic] {
#    proc syslog-ng &  /^STATS: dropped 0/		: drop
     proc tac_plus & /^Error verify: failed - could not authenticate for user '([^']+)' on NAS '([^']+)'/	: count 10 "failed auth for %1 on %2", drop
     proc tac_plus &  /^Error (\S+) tty\d+: Null reply packet, expecting CONTINUE$/	: count 10 "Null reply packets from %1", drop
     proc perl & /^pam_krb5: authenticate error: Decrypt integrity check failed/	: count 5 "pam_krb5: Decrypt integrity check failed", drop
     proc perl &  /^nss_ldap: could not get LDAP result - Can't contact LDAP server/	: count 5 "Can\'t contact LDAP server", drop
     proc perl & /^PAM-listfile: Refused user \w+ for service radiator/	: Count 10 "Refused user for service radiator", drop
     proc radiator_logfile      :drop
     proc radiator_detail       :drop
  }

}

[host scream : email=>dns-apps-logs ] {
  service solaris
  service squid
  [periodic] {
    proc sshd & re /^Accepted publickey for root from 130.216.190.7/	: drop
    proc sendmail &  re /^\[ID \d+ mail.info/				: drop
    proc sshd & re /^Accepted publickey for netacct from 130.216.3.31/	: drop
  }
}

[host ua-5 : email=>dns-network-admins] {
  service dial_in
}

[host uoa-vpn.net : email=>dns-network-admins] {
  service vpn
}

[host uoa-vpn2-back.net : email=>dns-network-admins] {
  service vpn
}

[host foundry-lb-1.net : ignore ] {
  service foundry}

[host test-lb.tel : ignore ] {
  service foundry
}

[host foundry-lb-2.net : ignore ] {
  service foundry 
}

[host foundry-190.net : ignore] {
  service foundry
}


[host vm-3750 : re /\w+-vm-3750.net/	; email=>neteng-staff] {
  service cisco
}

[host uoa-ape.net : email=>dns-network-admins] {
  service cisco
}

[host meter12.itss : email=>dns-apps-logs]  {
  service unix
  service linux
  service sshd
}

[host ponder.itss : email=>dns-apps-logs]  {
  service unix
  [periodic] {
    proc sshd & re /^Accepted publickey for root from 130.216.190.23/	: drop
  } 
}

[host stibbons.itss : email=>dns-apps-logs]  {
  service unix
}

[host cx-beta-to-prim.net : email=>dns-network-admins]  {
  service cisco
}
[host solidus-vpn.net : email=>dns-apps-logs ]{ 
  service cisco
  [periodic]{
    cat PIX & level 6 			: drop
    cat PIX & level 4 & event 400014	: drop
    cat PIX & level 4 & event 400011	: drop
    cat PIX & level 3 & event 313001	: drop
    cat PIX & level 6 & event 302013	: drop
    cat PIX & level 6 & event 302014	: drop
    cat PIX & level 6 & event 106015 & %r!Deny .+ from ([^\/]+)/!	: count 0 "dropped packets from %1",drop
    cat PIX & level 6 & event 602302:/	: drop
  }

}

[host dot-net : re /.+\.net$/	; email=>dns-network-admins] {
  service cisco
}


[service ciscowlan : file => all (Ciscowlan) ] {
  service cisco

  [periodic] {
     level >= 5                     : drop
     cat IAPP & level 3 & event MSGTAG015    : drop
     cat DHCP & level 4 & event MSGTAG098   : drop
  }	
}

[host cisco-lwapp-controller.wlan : email=>dns-network-admins ] {
  service ciscowlan
}

[host  cx-beta-wism-controller-a.net : email=>dns-network-admins ] {
  service ciscowlan
}