[global] {
  maildomain = auckland.ac.nz
  hostdomain = auckland.ac.nz
  mail_server = mailhost.auckland.ac.nz
  log_dir = /logs/HOSTS
  offset = selms

  include +UNIX.conf

}

# this section tries to cover all the legit su and sudo activity

$EC_UNIX_ADMIN = (?:yongbao|cwar037|richards|dqu002)
$ITSS_DBA = (?:diva003|nlat007|amcl065|srav002)
$ID = (?:\[ID [^\]]+\]\s*)

[service ecunixadmin] {
  [periodic] {
    proc sudo & re /^$EC_UNIX_ADMIN/					: drop
    proc su & re /'su root' succeeded for $EC_UNIX_ADMIN/			: drop
    proc su & re /'su \w+' succeeded for root/					: drop
  }
}



[service netaccount] {
  [periodic] {
    proc PWRMasterDaemon & re /recieved SIGHUP/	: drop
    proc PWRMasterDaemon & re /PWRProcessDeadModule: module PWRECKerberosModule died without unregistering/	: drop
    proc account & re /^upi is NULL/	: drop
    proc GroupList & re /groupGetDisplayViewModifyAndModifyProperties: Error 0 /	: drop
    proc  usereditservice & re /WritePOSAccountingDetails: -\d+ cents ip\s*Quota Failed to add to user/	: drop
    proc account & re /WritePOSAccountingDetails: -\d+ cents ip\s*Quota Failed to add to user/	: drop
    proc passwd & re /Failed for user \S+: Error \d+, Be more original/	: drop
    proc passwdd & re /Failed for user \w+: Error \d+, Be more original /	: drop
    proc pwrmasterdaemon & re /recieved SIGHUP, retrying failed children/		: drop
    proc pwreckerberosmodule & re /created new user '\S+' on 'EC.AUCKLAND.AC.NZ'/	: drop
    proc pwreckerberosmodule & re /EXPIRE \d/	: drop
    proc pwreckerberosmodule & re /Communication failure with server, while kadm5_chpass/	: drop
    proc pwradeckerberosmodule & re /ignoring Authentication error, prolly no such user/	: drop
    proc pwradeckerberosmodule & re /^I've sync'd 1000 passwords, will restart to stop memory leaks./	: drop
#    proc passwdnotify1.1 & re /set_passwd: localhost returned ERROR_SUCCESS when changing password for /	: drop
    re /set_passwd: localhost returned ERROR_SUCCESS when changing password for /	: drop
    proc passwd & re /Failed for user \w+: Error 4003, Be more original/	: drop

    proc bookserver & re /^Spawning CMDS\/rdbservice/		 : drop
    proc bookserver & re /^Spawning CMDS\/usereditservice/	: drop

    proc usereditservice & re /quotaLib: no records found for /	: drop
    proc usereditservice & re /^HandleBeginEditingUserRequest: Admin .+: DB Record not found/	: drop
    proc usereditservice & re /^HandleBeginEditingUserRequest: Admin .+: Error 0/	: drop
    proc usereditservice & re /^UserEditService: remoteIP.+ : Password expired/	: drop
    proc usereditservice & re /^HandleTransferQuotaRequest: .+  Failed in Deduction of \d+ from Source printQuota: /	: drop
    proc usereditservice & re /^LVerifyReceiveHeader\(\): packet type: \d+: token/	: drop
    proc usereditservice & re /^LPPReceiveVariablePacket[^:]+: packetType=\d+, Error ePPinvalid\s*Packet/	: drop
    proc usereditservice & re /^main: PPReceiveVariablePacket failed because the connection requested/	: drop
    proc usereditservice & re /^main: PPReceiveVariablePacket failed because an invalid packet was received/	: drop
    proc usereditservice & re /^HandleStartSecureSession\([^)]+\): DB Record not found/	: drop
    proc usereditservice & re /^main: User handle packet failed because an unknown error \(\d+\) occurred/	: drop
    proc UserEditService & re /^UserEditService: remoteIP = '\w+' accessGroup/	: drop
    proc usereditservice & re /user \S+ has no privileges to run this program: not in group/	: drop
    proc usereditservice & re /^HandleBeginEditingUserRequest: Admin .+ BARCODE_KEY \S+ : No result returned from query/	: drop
    proc usereditservice & re /userIdGetUpis: sqlResultVectorNew returned: DB Record not found/	: drop
    proc usereditservice & re /^WritePOSAccountingDetails: -\d+ cents copierQuota quota Failed to add to user/	: drop
    proc usereditservice & re /^HandleTransferQuotaRequest: \S+  Failed in Deduction of \d+ from Source copierQuota:/	: drop
    proc usereditservice & re /^LPPSendPacket\(\d+\): returned status: 2/	: drop
    proc usereditservice & re /^main: User handle packet failed because an invalid packet was received/	: drop
    proc usereditservice & re /^UserEditService: remoteIP = '[^']+' accessGroup = '[^']+'/	: drop

    proc 'rdb service' & re /^HandleGetPersonalDetailsRequest: Error fetching passwd for \S+ : Password expired/	: drop
    proc 'rdb service' & re /userIdGetUpis: sqlResultVectorNew returned: DB Record not found/	: drop
    proc 'rdb service' & re /^HandleGetPersonalDetailsRequest: key == '\d+': Not Found/	: drop
    proc 'rdb service' & re /^LPPReceiveVariablePacket[^:]+: Problem reading header: amount read = \d+ \(error \d+\) - aborting read/	: drop
    proc 'rdb service' & re /main: PPReceiveVariablePacket failed because the connection requested to be disconnected /	: drop
    proc 'rdb service' & re /HandleGetPersonalDetailsRequest: key == NULL or is empty/	: drop
    proc 'rdb service' & re /HandleGetPersonalDetailsRequest: Error fetching passwd for \w+ : Password expired/	: drop
    proc 'rdb service' & re /HandleGetPersonalDetailsRequest: key == '\w+': Not Found/	: drop
    proc 'rdb service' & re /LPPSendPacket\(\d+\): problem reading ack errno=104/	: drop
    proc 'rdb service' & re /Lost connection to MySQL server during query/	: count 10 "Lost connection to database", drop
    proc grouplist & re /groupGetDisplayViewModifyAndModifyProperties: Error \d/	: drop
    proc grouplist & re /Lost connection to MySQL server during query/		: count 10 "Lost connection to database", drop
    proc mismatch & re /wanted /	: drop
    proc exportusersvialdap & re /ldapa:ldapa_add_user_to_group: ldap_modify_s failed, No such object/	: drop
  }
}

[host data.ec : re /data\d.ec/	; email=>ecs-logs@lists.auckland.ac.nz] {
  service unix
  service sshd
  service nagios
  service netaccount
  service ecunixadmin
  [periodic] {
    proc sshd & re /^nss_ldap: reconnecting to LDAP server/		: drop
    proc sshd & re /^nss_ldap: reconnected to LDAP server after 1 a/	: drop
  }
}


[host ecafs : re /ecafs-\d\d-cdc.ec/	; email=>ecs-logs@lists ] {
  service unix 
  service sendmail
  service nagios
  service ipmon
  service cosign
  service srs
  service sshd
  service ecunixadmin
}

[host eckrb : re /eckrb-\d\d-cdc.ec/	; email=>ecs-logs@lists ] {
  service unix 
  service sendmail
  service nagios
  service ipmon
  service cosign
  service srs
  service sshd
  service ecunixadmin
}

